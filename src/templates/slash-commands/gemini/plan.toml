description = "Generate implementation task breakdown from PRD"
prompt = """

# Clavix Plan - Task Breakdown Generator

You are helping the user generate a CLEAR-optimized implementation task breakdown from their PRD.

## Instructions

### Part A: Procedural Steps (CLI Commands)

1. **Locate the PRD outputs**:
   - Look for the most recent artifacts in `.clavix/outputs/[project-name]/`
   - Accepted sources: `full-prd.md`, `quick-prd.md`, `mini-prd.md`, or `optimized-prompt.md`
   - **If not found**: Error inline - "No PRD found in `.clavix/outputs/`. Use `/clavix:prd` or `/clavix:summarize` first."

2. **Run the plan command**:
   ```bash
   clavix plan
   ```

   Or specify a project:
   ```bash
   clavix plan --project project-name
   ```

   Or generate tasks directly from a saved session (auto-creates mini-prd.md):
   ```bash
   clavix plan --session SESSION_ID
   ```

   The CLI will prompt you to pick a project when multiple outputs are available.

### Part B: Behavioral Guidance (Task Breakdown Strategy)

3. **How to structure tasks** (CLEAR-optimized task breakdown):

   **Task Granularity Principles:**
   - **[C] Concise**: Each task = 1 clear action (not "Build authentication system", but "Create user registration endpoint")
   - **[L] Logical**: Tasks flow in implementation order (database schema → backend logic → frontend UI)
   - **[E] Explicit**: Tasks specify deliverable (not "Add tests", but "Write unit tests for user service with >80% coverage")

   **Atomic Task Guidelines:**
   - **Ideal size**: Completable in 15-60 minutes
   - **Too large**: "Implement user authentication" → Break into registration, login, logout, password reset
   - **Too small**: "Import React" → Combine with "Setup component structure"
   - **Dependencies**: If Task B needs Task A, ensure A comes first

   **Phase Organization:**
   - Group related tasks into phases (Setup, Core Features, Testing, Polish)
   - Each phase should be independently deployable when possible
   - Critical path first (must-haves before nice-to-haves)

4. **Review and customize generated tasks**:
   - The command will generate `tasks.md` in the PRD folder
   - Tasks are organized into logical phases with CLEAR principles
   - Each task includes:
     - Checkbox `- [ ]` for tracking
     - Clear deliverable description
     - Optional reference to PRD section `(ref: PRD Section)`
   - **You can edit tasks.md** before implementing:
     - Add/remove tasks
     - Adjust granularity
     - Reorder for better flow
     - Add notes or sub-tasks

5. **CLEAR Task Labeling** (optional, for education):
   When reviewing tasks, you can annotate improvements:
   - **[C]**: "Split vague 'Add UI' into 3 concrete tasks"
   - **[L]**: "Reordered tasks: database schema before API endpoints"
   - **[E]**: "Added specific acceptance criteria (>80% test coverage)"

6. **Next steps**:
   - Review and edit `tasks.md` if needed
   - Then run `/clavix:implement` to start implementation

## Task Format

The generated `tasks.md` will look like:

```markdown
# Implementation Tasks

**Project**: [Project Name]
**Generated**: [Timestamp]


## Phase 1: Feature Name
- [ ] Task 1 description (ref: PRD Section)
- [ ] Task 2 description
- [ ] Task 3 description

## Phase 2: Another Feature
- [ ] Task 4 description
- [ ] Task 5 description


*Generated by Clavix /clavix:plan*
```

## Workflow Navigation

**You are here:** Plan (Task Breakdown)

**Common workflows:**
- **PRD workflow**: `/clavix:prd` → `/clavix:plan` → `/clavix:implement` → `/clavix:archive`
- **Conversation workflow**: `/clavix:summarize` → `/clavix:plan` → `/clavix:implement` → `/clavix:archive`
- **Standalone**: [Existing PRD] → `/clavix:plan` → Review tasks.md → `/clavix:implement`

**Related commands:**
- `/clavix:prd` - Generate PRD (typical previous step)
- `/clavix:summarize` - Extract mini-PRD from conversation (alternative previous step)
- `/clavix:implement` - Execute generated tasks (next step)

## Tips

- Tasks are automatically optimized using CLEAR framework
- Each task is concise and actionable
- Tasks can reference specific PRD sections
- Supports mini-PRD outputs from `/clavix:summarize` and session workflows via `--session` or `--active-session`
- You can manually edit tasks.md before implementing
- Use `--overwrite` flag to regenerate if needed

## Troubleshooting

### Issue: No PRD found in `.clavix/outputs/`
**Cause**: User hasn't generated a PRD yet
**Solution** (inline - already in template):
- Show error: "No PRD found in `.clavix/outputs/`"
- Suggest: "Use `/clavix:prd` or `/clavix:summarize` to generate one first"
- Do not proceed with plan generation

### Issue: Generated tasks are too granular (100+ tasks)
**Cause**: Over-decomposition or large project scope
**Solution**:
- Group related micro-tasks into larger atomic tasks
- Each task should be 15-60 minutes, not 5 minutes
- Combine setup/configuration tasks
- Suggest breaking project into multiple PRDs if truly massive

### Issue: Generated tasks are too high-level (only 3-4 tasks)
**Cause**: PRD was too vague or task breakdown too coarse
**Solution**:
- Review PRD - if vague, regenerate with more detail
- Break each high-level task into 3-5 concrete sub-tasks
- Each task should have a clear, testable deliverable

### Issue: Tasks don't follow logical dependency order
**Cause**: Generator didn't detect dependencies correctly
**Solution**:
- Manually reorder in tasks.md (database before API, API before UI)
- Follow CLEAR [L] Logic principle: ensure sequential coherence
- Group by technical layers or feature completion

### Issue: Tasks conflict with PRD or duplicate work
**Cause**: Misinterpretation of PRD or redundant task generation
**Solution**:
- Review PRD and tasks side-by-side
- Remove duplicate tasks
- Align tasks with PRD requirements
- Use `--overwrite` to regenerate after PRD clarification

### Issue: `tasks.md` already exists, unsure if should regenerate
**Cause**: Previous plan exists for this PRD
**Solution**:
- Check if tasks.md has progress (any [x] checkboxes)
- If no progress: Safe to use `--overwrite`
- If progress exists: Review carefully before overwriting
- Consider manual edits instead of full regeneration
"""
