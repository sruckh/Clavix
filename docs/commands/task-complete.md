# clavix task-complete

## Description
Mark a task as completed with validation and optional git commit. This command updates the task in `tasks.md`, tracks completion in config, updates progress statistics, and handles git commits based on the configured strategy. After completion, it displays the next incomplete task to continue the workflow.

## Syntax
```
clavix task-complete <taskId> [options]
```

## Arguments
- `<taskId>` â€“ Task ID to mark as completed (e.g., `phase-1-auth-1`, `setup-1`). Required.

## Flags
- `--no-git` â€“ Skip git commit even if strategy is enabled
- `-f, --force` â€“ Force completion even if already marked complete
- `-c, --config <path>` â€“ Path to config file (defaults to auto-discover)

## Inputs
- Task ID from `tasks.md` generated by `clavix plan`
- Implementation config file (`.clavix-implement-config.json`)
- Tasks file path (specified in config)

## Outputs
- Updated `tasks.md` with task marked as `[x]`
- Updated config file with completion tracking
- Progress statistics (completed/total, percentage, remaining)
- Next incomplete task information
- Optional git commit (based on strategy)

## Examples
- `clavix task-complete phase-1-auth-1`
- `clavix task-complete phase-2-api-3 --no-git`
- `clavix task-complete setup-1 --force`
- `clavix task-complete auth-impl-2 --config .clavix/outputs/my-feature/.clavix-implement-config.json`

## Workflow Integration

### Standard Implementation Workflow
1. Run `clavix implement` to start implementation
2. Work on the current task
3. Run `clavix task-complete <taskId>` to mark it done
4. Command displays next task automatically
5. Repeat steps 2-4 until all tasks complete

### Git Commit Strategies
The command respects the git strategy configured in `clavix implement`:

**Strategy: `none` (default)**
- No automatic commits
- Use `--no-git` flag is unnecessary

**Strategy: `per-task`**
- Creates commit after EVERY task completion
- Commit message: `clavix: <task description>`
- Best for: Large projects requiring detailed audit trail

**Strategy: `per-5-tasks`**
- Creates commit every 5 completed tasks
- Commit message includes all 5 task descriptions
- Best for: Moderate projects, balanced commit history

**Strategy: `per-phase`**
- Creates commit when entire phase completes
- Commit message includes all phase tasks
- Best for: Epic features with clear milestones

Override strategy with `--no-git` flag to skip commits for specific tasks.

### Auto-Discovery Behavior
The command automatically finds your config file by searching:
1. `.clavix/outputs/*/` directories for `.clavix-implement-config.json`
2. Skips `archive/` directory
3. Uses most recent config if multiple found
4. Override with `-c, --config` flag to specify exact path

## Common Messages

### Success Messages
- `âœ“ Task marked as completed` â€“ Task successfully updated in tasks.md
- `âœ“ Task was already completed (tracking updated)` â€“ Task was already `[x]` but config now tracks it
- `âœ“ Configuration updated` â€“ Config file updated with completion
- `âœ“ Git commit created` â€“ Commit successfully created per strategy
- `ðŸŽ‰ All tasks completed!` â€“ Final task marked, all implementation done

### Warning Messages
- `âš  Task "<taskId>" is already marked as completed` â€“ Task already done, use `--force` to re-mark
- `âš  Not a git repository - skipping commit` â€“ Git strategy enabled but not in git repo
- `âš  Git commit failed (non-critical)` â€“ Commit creation failed but task still marked complete
- `âš  No git changes to commit` â€“ Strategy triggered but no file changes detected

### Error Messages
- `âœ— Task ID "<taskId>" not found` â€“ Invalid task ID, see available tasks list
- `âœ— Failed to mark task as completed` â€“ File write error or validation failure
- `No .clavix/outputs directory found. Hint: Run "clavix implement" first to initialize` â€“ No implementation started
- `No config files found. Hint: Run "clavix implement" first to initialize` â€“ No config exists
- `Config file not found: <path>` â€“ Specified config path doesn't exist

## Troubleshooting

### Issue: Task ID not found
**Symptoms**: `âœ— Task ID "my-task" not found`

**Cause**: Typo in task ID or using wrong ID format

**Solution**:
1. Error message lists all available task IDs
2. Copy exact ID from the list (including phase prefix)
3. Or run `clavix implement` to see current task ID

### Issue: Stale in-memory task list (FIXED in v2.8.1)
**Symptoms**: Next task shows wrong information

**Cause**: Bug where command used stale task data (fixed in v2.8.1)

**Solution**:
- Upgrade to v2.8.1 or later
- Bug fix: Command now re-reads tasks.md after marking completion

### Issue: Git commits not created
**Symptoms**: Strategy is configured but no commits

**Possible Causes**:
1. **Strategy is `none`**: Check config file, change strategy in `clavix implement`
2. **Strategy threshold not met**: e.g., `per-5-tasks` only commits every 5 tasks
3. **No git changes**: No files modified, nothing to commit
4. **Not a git repo**: Directory is not a git repository
5. **Used `--no-git` flag**: Flag explicitly skips commits

**Solution**:
- Verify strategy: `cat .clavix/outputs/*/.clavix-implement-config.json | grep commitStrategy`
- Check git status: `git status`
- Remove `--no-git` flag if accidentally used
- For `per-5-tasks`, wait until 5th task completion

### Issue: Config file not found with auto-discovery
**Symptoms**: `No config files found`

**Cause**: No implementation workflow started

**Solution**:
1. Run `clavix implement` to initialize config
2. Or specify config path manually with `-c` flag
3. Check `.clavix/outputs/` directory exists

### Issue: Force flag needed unexpectedly
**Symptoms**: Task shows as complete but need to re-mark

**Possible Causes**:
1. Task manually edited in tasks.md
2. Re-running after partial failure
3. Config and tasks.md out of sync

**Solution**:
- Use `--force` flag to override completion check
- Verify tasks.md matches expected state
- Check config file's `completedTaskIds` array

## Recovery Options
If task completion fails, the command provides context-aware recovery suggestions:

1. **File permissions**: Check if tasks.md is readable and writable
2. **Task ID validation**: Run `clavix implement` to see current task ID
3. **Force completion**: Try `--force` flag if already complete
4. **Backup restoration**: Check for `tasks.md.backup` file created on errors

## Related Commands
- `clavix implement` â€“ Start implementation workflow (shows current task)
- `clavix plan` â€“ Generate tasks.md from PRD
- `clavix archive` â€“ Archive completed project (run after all tasks done)

## Next Steps
After marking all tasks complete:
1. Run `clavix archive` to archive the project
2. Create git tag for release
3. Update CHANGELOG
4. Merge feature branch
